# Migration

Species normally pair with their **neighbors** *(except humans that we can travel with plane...)*.

*Example:*

![distance](assets/distance.png "distnce")

If every cell of the square is an individual, we say that the distance is 1 equivalent to the probability of mating. 

```javascript
const gridLength = 100;
let grid;
let p = 0.5;
const maxMatingDistance = 1;
let generator_counter = 0;

const initGrid = () => {
    grid = Array(gridLength)
    .fill(1)
    .map(x => Array(gridLength).fill(1)
                .map(() => {
                    const x = Math.random();
                    if(x < p * p) return 'A1A1';
                    if(x > 1 - (1-p) * (1-p)) return 'A2A2';
                    else return 'A1A2';
                }));
};

initGrid();

const pickMatingPartner = (i, ii) => {
    const getBoundedIndex = i => {
        if(i < 0) return i + gridLength;
        else if(i >= gridLength) return i - gridLength;
        else return i;
    };
    const getRandomIndex = (min, max) =>  getBoundedIndex(Math.floor(Math.random() * (max - min + 1)) + min);

    const j = getRandomIndex(i - maxMatingDistance, i + maxMatingDistance);
    const jj = getRandomIndex(ii - maxMatingDistance, ii + maxMatingDistance);
    
    return grid[j][jj]; 
};

/**
* Get Offstring
* @param p1 - String (parent1)
* @param p2 - String (parent2)  
* @return String
*/
const getOffstring = (p1, p2) => {
    if(p1 === 'A1A1' && p2 === 'A1A1') return 'A1A1';
    if(p1 === 'A1A1' && p2 === 'A1A2' || p2 === 'A1A1' && p1 === 'A1A2')
         return Math.random() < 0.5 ? 'A1A1' : 'A1A2';
    if(p1 === 'A1A1' && p2 === 'A2A2' || p2 === 'A1A1' && p1 === 'A2A2')
        return 'A1A2';
    if(p1 === 'A1A2' && p2 === 'A1A2') {
        let n = Math.random();
        if(n < 0.25) return 'A1A1';
        if(n > 0.75) return 'A2A2';
        return 'A1A2';
    } 
    if(p1 === 'A2A2' && p2 === 'A1A2' || p2 === 'A2A2' && p1 === 'A1A2')
         return Math.random() < 0.5 ? 'A2A2' : 'A1A2';
    if(p1 === 'A2A2' && p2 === 'A2A2') return 'A2A2';
};

const runGeneration = ()=> {
    let arrayGrid = Array(gridLength).fill(1);

    let tempGrid = arrayGrid.map((x, i) => arrayGrid.map((xx, ii) => getOffstring(grid[i][ii], pickMatingPartner(i, ii))));
    
    tempGrid.forEach((x, i) => x.forEach((xx, ii) => grid[i][ii] = xx));
};

for(let i =  0; i < 100; i++) {
    let a1a1 = 0;
    let a2a2 = 0;
    let a1a2 = 0;

    grid.forEach(x => x.forEach(y => {
        if(y === 'A1A1') a1a1 ++;
        else if(y === 'A2A2') a2a2 ++;
        else a1a2 ++;
    }));

    console.log('A1A1', a1a1);
    console.log('A2A2', a2a2);
    console.log('A1A2', a1a2);

    runGeneration();
}

```